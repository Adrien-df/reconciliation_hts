
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MAPIE - Model Agnostic Prediction Interval Estimator &#8212; reconciliation_hts  documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p><a class="reference external" href="https://travis-ci.com/simai-ml/MAPIE"><img alt="Travis" src="https://travis-ci.com/simai-ml/MAPIE.svg?branch=master" /></a> <a class="reference external" href="https://ci.appveyor.com/project/gmartinonQM/mapie"><img alt="AppVeyor" src="https://ci.appveyor.com/api/projects/status/js4d7km6ckr801nj/branch/master?svg=true" /></a> <a class="reference external" href="https://codecov.io/gh/simai-ml/MAPIE"><img alt="Codecov" src="https://codecov.io/gh/simai-ml/MAPIE/branch/master/graph/badge.svg?token=F2S6KYH4V1" /></a> <a class="reference external" href="https://circleci.com/gh/simai-ml/MAPIE"><img alt="CircleCI" src="https://circleci.com/gh/simai-ml/MAPIE.svg?style=shield&amp;circle-token=:circle-token" /></a> <a class="reference external" href="https://mapie.readthedocs.io/en/latest"><img alt="ReadTheDocs" src="https://readthedocs.org/projects/mapie/badge" /></a> <a class="reference external" href="https://github.com/simai-ml/MAPIE/blob/master/LICENSE"><img alt="License" src="https://img.shields.io/github/license/simai-ml/MAPIE" /></a> <a class="reference external" href="https://pypi.org/project/mapie/"><img alt="PythonVersion" src="https://img.shields.io/pypi/pyversions/mapie" /></a> <a class="reference external" href="https://pypi.org/project/mapie/"><img alt="PyPi" src="https://img.shields.io/pypi/v/mapie" /></a></p>
<a class="reference internal image-reference" href="https://github.com/simai-ml/MAPIE/raw/master/doc/images/mapie_logo_nobg_cut.png"><img alt="https://github.com/simai-ml/MAPIE/raw/master/doc/images/mapie_logo_nobg_cut.png" class="align-center" src="https://github.com/simai-ml/MAPIE/raw/master/doc/images/mapie_logo_nobg_cut.png" style="width: 400px;" /></a>
<div class="section" id="mapie-model-agnostic-prediction-interval-estimator">
<h1>MAPIE - Model Agnostic Prediction Interval Estimator<a class="headerlink" href="#mapie-model-agnostic-prediction-interval-estimator" title="Permalink to this headline">¬∂</a></h1>
<p><strong>MAPIE</strong> allows you to easily estimate prediction intervals on single-output data using your favourite scikit-learn-compatible regressor.</p>
<p>Prediction intervals output by <strong>MAPIE</strong> encompass both aleatoric and epistemic uncertainty and are backed by strong theoretical guarantees [1].</p>
</div>
<div class="section" id="requirements">
<h1>üîó Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¬∂</a></h1>
<p>Python 3.7+</p>
<p><strong>MAPIE</strong> stands on the shoulders of giants.</p>
<p>Its only internal dependency is <a class="reference external" href="https://scikit-learn.org/stable/">scikit-learn</a>.</p>
</div>
<div class="section" id="installation">
<h1>üõ† Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¬∂</a></h1>
<p>Install via <cite>pip</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">mapie</span>
</pre></div>
</div>
<p>To install directly from the github repository :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">simai</span><span class="o">-</span><span class="n">ml</span><span class="o">/</span><span class="n">MAPIE</span>
</pre></div>
</div>
</div>
<div class="section" id="quickstart">
<h1>‚ö°Ô∏è Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¬∂</a></h1>
<p>Let us start with a basic regression problem.
Here, we generate one-dimensional noisy data that we fit with a linear model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_regression</span>

<span class="n">regressor</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_regression</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">59</span><span class="p">)</span>
</pre></div>
</div>
<p>Since MAPIE is compliant with the standard scikit-learn API, we follow the standard
sequential <code class="docutils literal notranslate"><span class="pre">fit</span></code> and <code class="docutils literal notranslate"><span class="pre">predict</span></code> process  like any scikit-learn regressor.
We set two values for alpha to estimate prediction intervals at approximately one
and two standard deviations from the mean.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mapie.estimators</span> <span class="kn">import</span> <span class="n">MapieRegressor</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">]</span>
<span class="n">mapie</span> <span class="o">=</span> <span class="n">MapieRegressor</span><span class="p">(</span><span class="n">regressor</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
<span class="n">mapie</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">y_preds</span> <span class="o">=</span> <span class="n">mapie</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
<p>MAPIE returns a <code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code> of shape (n_samples, 3, len(alpha)) giving the predictions,
as well as the lower and upper bounds of the prediction intervals for the target quantile
for each desired alpha value.
The estimated prediction intervals can then be plotted as follows.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">mapie.metrics</span> <span class="kn">import</span> <span class="n">coverage_score</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_preds</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">)</span>
<span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">y_preds</span><span class="p">[</span><span class="n">order</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">y_preds</span><span class="p">[</span><span class="n">order</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">order</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y_preds</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">][</span><span class="n">order</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y_preds</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">][</span><span class="n">order</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">coverage_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">coverage_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_preds</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">y_preds</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">alpha</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Target and effective coverages for alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">: (</span><span class="si">{</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">coverage_scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
    <span class="sa">f</span><span class="s2">&quot;Target and effective coverages for alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">: (</span><span class="si">{</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">coverage_scores</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The title of the plot compares the target coverages with the effective coverages.
The target coverage, or the confidence interval, is the fraction of true labels lying in the
prediction intervals that we aim to obtain for a given dataset.
It is given by the alpha parameter defined in <code class="docutils literal notranslate"><span class="pre">MapieRegressor</span></code>, here equal to 0.05 and 0.32,
thus giving target coverages of 0.95 and 0.68.
The effective coverage is the actual fraction of true labels lying in the prediction intervals.</p>
<a class="reference internal image-reference" href="https://github.com/simai-ml/MAPIE/raw/master/doc/images/quickstart_1.png"><img alt="https://github.com/simai-ml/MAPIE/raw/master/doc/images/quickstart_1.png" class="align-center" src="https://github.com/simai-ml/MAPIE/raw/master/doc/images/quickstart_1.png" style="width: 400px;" /></a>
</div>
<div class="section" id="documentation">
<h1>üìò Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¬∂</a></h1>
<p>The documentation can be found <a class="reference external" href="https://mapie.readthedocs.io/en/latest/">on this link</a>.
It contains the following sections:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://mapie.readthedocs.io/en/latest/quick_start.html">Quickstart</a></p></li>
<li><p><a class="reference external" href="https://mapie.readthedocs.io/en/latest/theoretical_description.html">Theoretical description</a></p></li>
<li><p><a class="reference external" href="https://mapie.readthedocs.io/en/latest/tutorial.html">Tutorial</a></p></li>
<li><p><a class="reference external" href="https://mapie.readthedocs.io/en/latest/api.html">API</a></p></li>
<li><p><a class="reference external" href="https://mapie.readthedocs.io/en/latest/auto_examples/index.html">Examples</a></p></li>
</ul>
</div>
<div class="section" id="contributing">
<h1>üìù Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¬∂</a></h1>
<p>You are welcome to propose and contribute new ideas.
We encourage you to <a class="reference external" href="https://github.com/simai-ml/MAPIE/issues">open an issue</a> so that we can align on the work to be done.
It is generally a good idea to have a quick discussion before opening a pull request that is potentially out-of-scope.
For more information on the contribution process, please go <a class="reference external" href="CONTRIBUTING.rst">here</a>.</p>
</div>
<div class="section" id="affiliations">
<h1>ü§ù  Affiliations<a class="headerlink" href="#affiliations" title="Permalink to this headline">¬∂</a></h1>
<p>MAPIE has been developed through a collaboration between Quantmetry, Michelin, and ENS Paris-Saclay
with the financial support from R√©gion Ile de France.</p>
<p><a class="reference external" href="https://www.quantmetry.com/"><img alt="Quantmetry" src="https://www.quantmetry.com/wp-content/uploads/2020/08/08-Logo-quant-Texte-noir.svg" width="150" /></a> <a class="reference external" href="https://www.michelin.com/en/"><img alt="Michelin" src="https://www.michelin.com/wp-content/themes/michelin/public/img/michelin-logo-en.svg" width="100" /></a> <a class="reference external" href="https://ens-paris-saclay.fr/en"><img alt="ENS" src="https://file.diplomeo-static.com/file/00/00/01/34/13434.svg" width="100" /></a> <a class="reference external" href="https://www.iledefrance.fr/"><img alt="IledeFrance" src="https://www.iledefrance.fr/themes/custom/portail_idf/logo.svg" width="100" /></a></p>
</div>
<div class="section" id="references">
<h1>üîç  References<a class="headerlink" href="#references" title="Permalink to this headline">¬∂</a></h1>
<p>MAPIE methods are based on the work by <a class="reference external" href="https://www.stat.uchicago.edu/~rina/jackknife.html">Foygel-Barber et al. (2020)</a>.</p>
<p>[1] Rina Foygel Barber, Emmanuel J. Cand√®s, Aaditya Ramdas, and Ryan J. Tibshirani.
Predictive inference with the jackknife+. Ann. Statist., 49(1):486‚Äì507, 022021</p>
</div>
<div class="section" id="id2">
<h1>üìù License<a class="headerlink" href="#id2" title="Permalink to this headline">¬∂</a></h1>
<p>MAPIE is free and open-source software licensed under the <a class="reference external" href="https://github.com/simai-ml/MAPIE/blob/master/LICENSE">3-clause BSD license</a>.</p>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">reconciliation_hts</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Adrien de Forceville.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/README.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>